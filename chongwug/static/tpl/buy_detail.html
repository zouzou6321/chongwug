{% extends 'tpl/base/base.html' %}
{% load assets %}

{% block title %}详情页{% endblock %}
{% block bodyhook %}class="has-position"{% endblock %}

{% block content %}

<div class="">
    <div class="container content-container">
        <div class="row">
            <div class="col-md-6">
                <ol class="breadcrumb">
                  <li><a href="/home">首页</a></li>
                  <li><a href="/buy">我要买狗</a></li>
                  <li class="active">城南狗舍</li>
                </ol>
            </div>
        </div>
        <div class="row">
            <div class="col-md-5">
                <a href="javascript:" class="cwg-thumb">
                    <img src="{{ petimg_a.img_url }}" class="img-full"/>
                </a>
                <div class="cwg-dog-imgs">
                    <a class="prev-thumb" href="javascript:"><i class="glyphicon glyphicon-chevron-left"></i></a>
                    <div class="thumbnail-wrap">
                        <ul class="cwg-thumbnail clearfix">
                        <li class="active" data-src="{{ petimg_a.img_url }}"><img src="{{ petimg_a.img_url }}!small"/></li>
                        {% for nowimg in nowimgs %}
                            <li data-src="{{ nowimg.img_url }}"><img src="{{ nowimg.img_url }}!small"/></li>
                        {% endfor %}
                        </ul>
                    </div>
                    <a class="next-thumb" href="javascript:"><i class="glyphicon glyphicon-chevron-right"></i></a>
                </div>
{#                <!-- JiaThis Button BEGIN -->#}
{#                <div class="jiathis_style">#}
{#                <a class="jiathis_button_qzone"></a>#}
{#                <a class="jiathis_button_tsina"></a>#}
{#                <a class="jiathis_button_renren"></a>#}
{#                <a class="jiathis_button_cqq"></a>#}
{#                <a class="jiathis_button_weixin"></a>#}
{#                <a class="jiathis_button_douban"></a>#}
{#                </div>#}
{#                <script type="text/javascript" >#}
{#                var jiathis_config={#}
{#                    url:"chongwug.com",#}
{#                    summary:"摘要",#}
{#                    title:"标题 #微博话题#",#}
{#                    pic:"http://chongwug-pic.b0.upaiyun.com/petpic/8172c56e-4398-11e4-adc8-d9400486119f.jpeg",#}
{#                    ralateuid:{#}
{#                        "tsina":"关注新浪ID"#}
{#                    },#}
{#                    appkey:{#}
{#                        "tsina":"3677235683",#}
{#                        "tqq":"CWu2zuJD94Zi3pcv",#}
{#                        "t163":"网易key",#}
{#                        "tsouhu":"搜狐key",#}
{#                        "tpeople":"人民key"#}
{#                    },#}
{#                    shortUrl:true,#}
{#                    hideMore:true#}
{#                }#}
{#                </script>#}
{#                <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>#}
{#                <!-- JiaThis Button END -->#}
            </div>
            <div class="col-md-7">
                <h1 class="cwg-detail-title">[城{{ nestpet.farm.direct }}-{{ nestpet.farm.district }}]{{ nestpet.farm.name }} {{ nestpet.color }}{{ nestpet.type }}</h1>
                <p class="detail-title-desc">{{ nestpet.short_desc }}</p>
                <div class="cwg-detail-info">
                    <div class="info-row clearfix">
                        <div class="info-td-left">
                            编<span class="middle-space"></span>号：
                        </div>
                        <div class="info-td-right">
                            89757
                        </div>
                    </div>
                    <div class="info-row clearfix">
                        <div class="info-td-left">
                            犬<span class="middle-space"></span>种：
                        </div>
                        <div class="info-td-right">
                            {{ nestpet.type }}
                        </div>
                    </div>
                    <div class="info-row clearfix">
                        <div class="info-td-left">
                             月<span class="middle-space"></span>龄：
                        </div>
                        <div class="info-td-right">
                            {{ nestpet.age }}个月
                        </div>
                    </div>
                    <div class="info-row clearfix">
                        <div class="info-td-left">
                             疫<span class="middle-space"></span>苗：
                        </div>
                        <div class="info-td-right">
                            已种疫苗
                        </div>
                    </div>
                    <div class="info-row clearfix" style="border-bottom: 0">
                        <div class="info-td-left">
                            价<span class="middle-space"></span>格：
                        </div>
                        <div class="info-td-right">
                           <span class="price price-dark price-sm">{{ price.min_price }}-{{ price.max_price }}<span class="price-desc">元/只</span></span>
                        </div>
                    </div>
                    <div class="info-row clearfix">
                        <div class="info-td-right">
                            <a href="" class="btn btn-primary btn-order" data-toggle="modal" data-target="#cwg-order-modal">预约看狗</a>
                            <a href="" class="btn btn-info btn-consult">在线咨询</a>
                            <a href="" class="cwg-clause"><i class="glyphicon glyphicon-question-sign"></i>购犬须知</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="detail-navbar" id="js-affix-scrollspy">
       <div class="container content-container">
           <ul class="nav navbar-nav">
                <li class="active"><a href="#pet-info" class="placard">狗狗资料</a></li>
                <li><a href="#pet-farm" class="placard">犬舍简介</a></li>
                <li><a href="#pet-showcase" class="placard">其他犬种</a></li>
                <li><a href="#pet-guarantee" class="placard">保障服务</a></li>
            </ul>
       </div>
    </div>

    <div class="container content-container">
        <div class="row">
            <div class="col-md-9 detail-main">
                <div id="pet-info">
                    <h2 class="desc-tit">
                        <span class="placard">犬</span>狗狗资料
                    </h2>
                    <div class="desc-main">
                        <table class="table table-primary table-center">
                            <caption>泰迪</caption>
                            <thead>
                                <tr>
                                    <th>&nbsp;</th>
                                    <th>&nbsp;</th>
                                    <th>性别</th>
                                    <th>月龄</th>
                                    <th>颜色</th>
                                    <th>疫苗</th>
                                    <th>价格</th>
{#                                    <th>出售情况</th>#}
{#                                    <th>&nbsp;</th>#}
                                </tr>
                            </thead>
                            <tbody>
                            	{% for pet in allpets %}
                                <tr>
                                    <td>A</td>
                                    <td>
                                        <i class="pet-icon"></i>
                                    </td>
                                    <td>{{ pet.sex }}</td>
                                    <td>{{ nestpet.age }}个月</td>
                                    <td>{{ pet.color }}</td>
                                    <td>
                                    	{% if pet.epidemic_period == '已种疫苗' %}
                                        <i class="glyphicon glyphicon-ok-sign text-primary"></i>
                                        {% elif pet.epidemic_period == '未种疫苗' %}
                                        <i class="glyphicon glyphicon-ok-sign text-muted"></i>
                                        {% else %}
                                        {{ pet.epidemic_period }}
                                        {% endif %}
                                    </td>
                                    <td>&yen; {{ pet.price }}</td>
{#                                    <td>立即购买</td>#}
{#                                    <td><button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#cwg-order-modal" data-id="{{ pet.id }}">预约看狗</button></td>#}
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="7">
                                        <p class="pet-tip"><i class="icon-car"></i><span>你看狗 我接送</span></p>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div id="pet-farm">
                    <h2 class="desc-tit">
                        <span class="placard">舍</span>犬舍简介
                    </h2>
                    <div class="desc-main">
                        <div class="row img-row">
                            <div class="col-xs-6">
                                <img data-original="{{ farmimg.img_url }}" class="js-lazy img-full" src="{{'imgs/loading.gif'|assets}}"/>
                            </div>
                            <div class="col-xs-6">
                                <img data-original="{{ farmimg.img_url }}" class="js-lazy img-full" src="{{'imgs/loading.gif'|assets}}"/>
                            </div>
                            <div class="col-xs-6">
                                <img data-original="{{ farmimg.img_url }}" class="js-lazy img-full" src="{{'imgs/loading.gif'|assets}}"/>
                            </div>
                            <div class="col-xs-6">
                                <img data-original="{{ farmimg.img_url }}" class="js-lazy img-full" src="{{'imgs/loading.gif'|assets}}"/>
                            </div>
                        </div>
                        <table class="table table-primary table-pet-kennel">
                            <caption>犬舍信息</caption>
                            <colgroup>
                                <col width="160px"/>
                            </colgroup>
                            <tr>
                                <td class="text-center">犬舍规模</td>
                                <td>中国农业银行(科技园支行),中国工商银行(武侯科技园支行),中国工商银行(百锦分理处),中国工商银行(金兴支行),中国建设银行(簇锦北路支行),中国农业银行(成都簇桥支行),交通银行(金兴南路支行),中国工商银行(武科西四路分理处),中国农业银行(武兴二路支行),中国农业银行(成都聚龙路支行)</td>
                            </tr>
                            <tr>
                                <td class="text-center">地址</td>
                                <td>聚龙路西站：151路，338路，1039路。武侯立交桥西站：72路，92路，175路，233路，242路，334路，335路，516路，846路，848路。</td>
                            </tr>
                            <tr>
                                <td class="text-center">医院</td>
                                <td>四川省人民医院辅导金桥医院,新纪元医院,武侯区第三人民医院,成都武侯新城医院,成都市武侯簇桥医院,华美医疗妇科专业,簇桥妇科诊疗中心,武侯仁爱医疗,武侯区簇桥耀康医疗,龙井医疗站</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div id="pet-showcase" class="pet-showcase">
                    <h2 class="desc-tit">
                        <span class="placard">其</span>其他犬种
                    </h2>
                    <div class="desc-main">
                        <div class="row margin-sm">
                            {% for pet_img in pets_img %}
                            <div class="col-md-6 padding-sm">
                                <div class="pet-showcase-item shade shade-hover">
                                    <img data-original="{{ pet_img.img.img_url }}" alt="{{ pet_img.pet.type }}" class="js-lazy img-full" src="{{'imgs/loading.gif'|assets}}"/>
                                    <p class="tag">{{ pet_img.pet.type }}</p>
                                    <div class="shade-content">
                                        <div class="pet-showcase-detail">
                                            <p>数量：{{ pet_img.count }}只</p>
                                            <p>月龄：{{ pet_img.pet.age }}个月</p>
                                            <p>价格：<span class="price price-light price-sm">{{ pet_img.min_price }}-{{ pet_img.max_price }}<span class="price-desc">元</span></span></p>
                                            <p>
                                                <a class="btn btn-primary" href="/buy/detail/?petid={{ pet_img.pet.id }}">详细信息</a>
                                                <button class="btn btn-primary btn-trans" data-id="{{ pet_img.pet.id }}" data-toggle="modal" data-target="#cwg-order-modal">预约看狗</button>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div id="pet-guarantee">
                    <h2 class="desc-tit">
                        <span class="placard">保</span>保障服务
                    </h2>
                    <div class="desc-main">
                        <div class="adg-health">
                            <img src="/static/assets/imgs/nav/adg1.png" class="img-full"/>
                        </div>
                        <div class="adg-price">
                            <img src="/static/assets/imgs/nav/adg2.png" class="img-full"/>
                        </div>
                        <div class="adg-purebred">
                            <img src="/static/assets/imgs/nav/adg3.png" class="img-full"/>
                        </div>
                        <div class="adg-process">
                            <img src="/static/assets/imgs/nav/adg4.png" class="img-full"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 most-popular">
            {% for recommendpet_img in recommendpets_img %}
                <div>
                    <a href="?petid={{ recommendpet_img.pet.id }}">
                        <img data-original="{{ recommendpet_img.img.img_url }}" class="img-full js-lazy" src="{{'imgs/loading.gif'|assets}}" >
                    </a>
                    <div class="dog-desc">
                        <h4><a href="?petid={{ recommendpet_img.pet.id }}">[城{{ recommendpet_img.pet.farm.direct }}-{{ recommendpet_img.pet.farm.district }}]{{ recommendpet_img.pet.farm.name }} {{ recommendpet_img.pet.color }}{{ recommendpet_img.pet.type }}</a></h4>
                        <p>
                            <span class="price price-primary price-xs">{{ recommendpet_img.pet.min_price|floatformat }}-{{ recommendpet_img.pet.max_price|floatformat }}<span class="price-desc">元/只</span></span>
                        </p>
                    </div>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="cwg-info-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">预约成功</h4>
      </div>
      <div class="modal-body">我们已经收到你的预约！</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">确定</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cwg-farm-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">本养殖场其它宠物</h4>
      </div>
      <div class="modal-body"></div>
    </div>
  </div>
</div>

<div class="modal fade" id="cwg-order-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">预约看狗</h4>
      </div>
      <div class="modal-body">
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
              <form class="form-horizontal">
                    <div class="form-group">
                    <label for="name" class="col-sm-3 control-label">您的名字：</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" id="name">
                    </div>
                    </div>
                    <div class="form-group">
                        <label for="tel" class="col-sm-3 control-label">您的手机：</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="tel">
                        </div>
                    </div>
              </form>
            </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary">提交</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    (function($){
        //lightbox
        var $thumb = $('.cwg-thumb'),
            $img = $thumb.find('img'),
            $thumbnail = $('.cwg-thumbnail'),
            $li = $thumbnail.find('li'),
            items = [];

        $.each($li, function(i, e){
            items.push({
                src: $(e).data('src')
            });
        });

        $thumb.on('click', function(){
            $.magnificPopup.open({
                items: items,
                type: 'image',
                gallery: {
                    enabled: true
                }
            }, $li.filter('.active').index());
        });

        //carousel
        $('.thumbnail-wrap').simpleCarousel({
            itemWidth: 66,
            prev: '.prev-thumb',
            next: '.next-thumb',
            callback: function($curr){
                $img.attr('src', $curr.data('src'));
            }
        });

        //type
        var $farmModal = $('#cwg-farm-modal'),
            $farmBody = $farmModal.find('.modal-body');

        $('.cwg-detail-pills').on('click', 'a', function(){
            var $this = $(this),
                type = $this.data('type'),
                id = $this.data('id');

            $.ajax('/buy/detail', {
                data: {farmid: id, type: type}
            }).done(function(data){
                $farmBody.html(data);
                $farmModal.modal('show');
            });

        });

        //scroll fixed nav
//        var $detailNav = $('.cwg-detail-nav');
//        $(window).on('scroll', function(){
//            var $this = $(this);
//            if($this.scrollTop() - $detailNav.offset().top > 0){
//                $detailNav.addClass('cwg-detail-nav-fixed');
//            }else{
//                $detailNav.removeClass('cwg-detail-nav-fixed');
//            }
//        });

        //order
        var $orderModal = $('#cwg-order-modal'),
            $infoModal = $('#cwg-info-modal');

        $orderModal.find('.btn-primary').on('click', function(){
            $.ajax({
                url: '/buy/detail/attention/',
                type: 'get',
                data: {name: $('#name').val(), tel: $('#tel').val(), petid: $.args('petid')},
                dataType: 'json',
                success: function(data){
                    if(data.status == 'success'){
                        $orderModal.modal('hide');
                        $infoModal.modal('show');
                    }else{
                        alert(data.message);
                    }
                }
            });
        });

        //detail nav affix
        var $affixScrollspy = $('#js-affix-scrollspy');
        $affixScrollspy.affix({
            offset: {
                top: 600
            }
        });
        //scroll spy
        $('body').scrollspy({ target: '#js-affix-scrollspy' });
    }(jQuery));

</script>
{% endblock %}
