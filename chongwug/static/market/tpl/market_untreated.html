{% extends 'market/tpl/base/base.html' %}
{% load assets_market %}
{% block title %}内容编辑{% endblock %}
{% block css %}
<link rel="stylesheet" href="{{ 'css/jquery.dataTables.css'|assets_market }}"/>
<link rel="stylesheet" href="{{ 'css/dataTables.editor.css'|assets_market }}"/>
{% endblock %}
{% block main %}
<h1 class="page-header">预约订单</h1>

<table class="table table-striped" id="js-order-info-table">
    <thead>
        <tr>
            <th>编号</th>
            <th>姓名</th>
            <th>电话</th>
            <th>犬舍</th>
            <th>犬种</th>
            <th>预约时间</th>
            <th>预约地点</th>
            <th>交通方式</th>
            <th>是否受理</th>
            <th>订单提交时间</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="modal fade" data-backdrop="static" id="js-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">修改</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" onsubmit="return false;">
                    <div class="form-group">
                        <label for="petfarm" class="control-label col-sm-3">犬舍：</label>
                        <div class="col-sm-4">
                            <select name="petfarm" id="petfarm" class="form-control">
                                <option value="111">111</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="pettype" class="control-label col-sm-3">犬种：</label>
                        <div class="col-sm-4">
                            <select name="pettype" id="pettype" class="form-control">
                                <option value="111">111</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="appointtime" class="control-label col-sm-3">预约时间：</label>
                        <div class="col-sm-6">
                            <input type="text" name="appointtime" id="appointtime" class="form-control" data-date-format="YYYY-MM-DD HH:mm:ss"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">预约地点：</label>
                        <div class="col-sm-9 row">
                            <input name="location" type="hidden" id="location"/>
                            <div class="col-sm-4">
                                <select name="province" class="form-control">
                                    <option value="111">111</option>
                                </select>
                            </div>
                            <div class="col-sm-4">
                                <select name="city" class="form-control">
                                    <option value="222">222</option>
                                </select>
                            </div>
                            <div class="col-sm-4">
                                <select name="district" class="form-control">
                                    <option value="333">333</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">交通方式：</label>
                        <div class="col-sm-4">
                            <label class="radio-inline">
                              <input type="radio" name="trans" value="drive"> 自驾
                            </label>
                            <label class="radio-inline">
                              <input type="radio" name="trans" value="lift"> 接送
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="accept" class="control-label col-sm-3">是否受理：</label>
                        <div class="col-sm-4">
                            <select name="accept" id="accept" class="form-control">
                                <option value="2">已受理</option>
                                <option value="4">预约失败</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
<script src="{{ 'lib/datatables/jquery.datatables.js'|assets_market }}"></script>
<script src="{{ 'lib/datatables/datatables.editor.js'|assets_market }}"></script>
<script>
;(function($){
    var $orderInfoTable = $('#js-order-info-table'),
        filter = 'untreated',
        acceptMap = {
            '1': '已预约',
            '2': '已受理',
            '3': '未受理',
            '4': '预约失败',
            '5': '已完成'
        },
        transMap = {
            'lift': '接送',
            'drive': '自驾'
        },
        orderInfoTable = $orderInfoTable.DataTable({
            serverSide: true,
            processing: true,
            ajax: {
                url: '/market/attention/data/',
                data: function ( d ) {
                    d.filter = filter;
                }
            },
            ordering: false,
            searching: false,
            lengthChange: false,
            bAutoWidth: false,
            language: {
                url: "{{ 'lib/datatables/zh-CN.json'|assets_market }}"
            }
            ,columnDefs: [{
                targets: 7,
                render: function(data, type, full, meta){
                    return type == 'display' ? transMap[data] : data;
                }
            }, {
                targets: 8,
                className: 'col-accept',
                render: function(data, type, full, meta){
                    return type == 'display' ? acceptMap[data] : data;
                }
            }]
            ,columns: [
                {data: 'id'},
                {data: 'name'},
                {data: 'tel'},
                {data: 'petfarm'},
                {data: 'pettype'},
                {data: 'appointtime'},
                {data: 'location'},
                {data: 'trans'},
                {data: 'accept'},
                {data: 'time'},
                {
                    data: null,
                    defaultContent: '<a href="javascript:" class="btn-edit"><i class="glyphicon glyphicon-pencil"></i></a>'
                }
            ]
        });

    var orderInfoEditor = new $.fn.dataTable.Editor({
        ajax: '/market/attention/mod/',
        table: "#js-order-info-table",
        fields: [{
            name: 'accept',
            label: '是否受理',
            type: 'select',
            ipOpts: [{
                label: acceptMap[2],
                value: '2'
            },{
                label: acceptMap[4],
                value: '4'
            }]
        }]
    });

    var $modal = $('#js-modal'),
        $appointTime = $modal.find('#appointtime');

    $orderInfoTable.on('click', '.btn-edit', function(){
       $modal.modal('show');
{#        orderInfoEditor#}
{#            .title( '修改' )#}
{#            .buttons( { "label": "确定", "fn": function () { orderInfoEditor.submit(null, null, function(data){#}
{#                    data.filter = filter;#}
{#                }) } } )#}
{#            .edit( $(this).closest('tr') );#}
    });

}(jQuery));

</script>
{% endblock %}