!function(e){function t(){return e("<div/>")}var o=Math.abs,i=Math.max,n=Math.min,s=Math.round;e.imgAreaSelect=function(d,r){function a(e){return e+yt.left-bt.left}function c(e){return e+yt.top-bt.top}function l(e){return e-yt.left+bt.left}function u(e){return e-yt.top+bt.top}function h(e){return e.pageX-bt.left}function f(e){return e.pageY-bt.top}function m(e){var t=e||Q,o=e||X;return{x1:s(vt.x1*t),y1:s(vt.y1*o),x2:s(vt.x2*t),y2:s(vt.y2*o),width:s(vt.x2*t)-s(vt.x1*t),height:s(vt.y2*o)-s(vt.y1*o)}}function p(e,t,o,i,n){var d=n||Q,r=n||X;vt={x1:s(e/d||0),y1:s(t/r||0),x2:s(o/d||0),y2:s(i/r||0)},vt.width=vt.x2-vt.x1,vt.height=vt.y2-vt.y1}function y(){E&&lt.width()&&(yt={left:s(lt.offset().left),top:s(lt.offset().top)},D=lt.innerWidth(),R=lt.innerHeight(),yt.top+=lt.outerHeight()-R>>1,yt.left+=lt.outerWidth()-D>>1,F=s(r.minWidth/Q)||0,G=s(r.minHeight/X)||0,J=s(n(r.maxWidth/Q||1<<24,D)),U=s(n(r.maxHeight/X||1<<24,R)),"1.3.2"!=e().jquery||"fixed"!=xt||wt.getBoundingClientRect||(yt.top+=i(document.body.scrollTop,wt.scrollTop),yt.left+=i(document.body.scrollLeft,wt.scrollLeft)),bt=/absolute|relative/.test($.css("position"))?{left:s($.offset().left)-$.scrollLeft(),top:s($.offset().top)-$.scrollTop()}:"fixed"==xt?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},L=a(0),j=c(0),(vt.x2>D||vt.y2>R)&&k())}function b(t){if(Z){switch(ut.css({left:a(vt.x1),top:c(vt.y1)}).add(ht).width(rt=vt.width).height(at=vt.height),ht.add(ft).add(pt).css({left:0,top:0}),ft.width(i(rt-ft.outerWidth()+ft.innerWidth(),0)).height(i(at-ft.outerHeight()+ft.innerHeight(),0)),e(mt[0]).css({left:L,top:j,width:vt.x1,height:R}),e(mt[1]).css({left:L+vt.x1,top:j,width:rt,height:vt.y1}),e(mt[2]).css({left:L+vt.x2,top:j,width:D-vt.x2,height:R}),e(mt[3]).css({left:L+vt.x1,top:j+vt.y2,width:rt,height:R-vt.y2}),rt-=pt.outerWidth(),at-=pt.outerHeight(),pt.length){case 8:e(pt[4]).css({left:rt>>1}),e(pt[5]).css({left:rt,top:at>>1}),e(pt[6]).css({left:rt>>1,top:at}),e(pt[7]).css({top:at>>1});case 4:pt.slice(1,3).css({left:rt}),pt.slice(2,4).css({top:at})}t!==!1&&(e.imgAreaSelect.onKeyPress!=zt&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),r.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=zt)),kt&&ft.outerWidth()-ft.innerWidth()==2&&(ft.css("margin",0),setTimeout(function(){ft.css("margin","auto")},0))}}function g(e){y(),b(e),_=a(vt.x1),et=c(vt.y1),tt=a(vt.x2),ot=c(vt.y2)}function x(e,t){r.fadeSpeed?e.fadeOut(r.fadeSpeed,t):e.hide()}function v(e){var t=l(h(e))-vt.x1,o=u(f(e))-vt.y1;ct||(y(),ct=!0,ut.one("mouseout",function(){ct=!1})),Y="",r.resizable&&(o<=r.resizeMargin?Y="n":o>=vt.height-r.resizeMargin&&(Y="s"),t<=r.resizeMargin?Y+="w":t>=vt.width-r.resizeMargin&&(Y+="e")),ut.css("cursor",Y?Y+"-resize":r.movable?"move":""),T&&T.toggle()}function w(){e("body").css("cursor",""),(r.autoHide||vt.width*vt.height==0)&&x(ut.add(mt),function(){e(this).hide()}),e(document).unbind("mousemove",C),ut.mousemove(v),r.onSelectEnd(d,m())}function S(t){return 1!=t.which?!1:(y(),Y?(e("body").css("cursor",Y+"-resize"),_=a(vt[/w/.test(Y)?"x2":"x1"]),et=c(vt[/n/.test(Y)?"y2":"y1"]),e(document).mousemove(C).one("mouseup",w),ut.unbind("mousemove",v)):r.movable?(q=L+vt.x1-h(t),B=j+vt.y1-f(t),ut.unbind("mousemove",v),e(document).mousemove(W).one("mouseup",function(){r.onSelectEnd(d,m()),e(document).unbind("mousemove",W),ut.mousemove(v)})):lt.mousedown(t),!1)}function z(e){V&&(e?(tt=i(L,n(L+D,_+o(ot-et)*V*(tt>_||-1))),ot=s(i(j,n(j+R,et+o(tt-_)/V*(ot>et||-1)))),tt=s(tt)):(ot=i(j,n(j+R,et+o(tt-_)/V*(ot>et||-1))),tt=s(i(L,n(L+D,_+o(ot-et)*V*(tt>_||-1)))),ot=s(ot)))}function k(){_=n(_,L+D),et=n(et,j+R),o(tt-_)<F&&(tt=_-F*(_>tt||-1),L>tt?_=L+F:tt>L+D&&(_=L+D-F)),o(ot-et)<G&&(ot=et-G*(et>ot||-1),j>ot?et=j+G:ot>j+R&&(et=j+R-G)),tt=i(L,n(tt,L+D)),ot=i(j,n(ot,j+R)),z(o(tt-_)<o(ot-et)*V),o(tt-_)>J&&(tt=_-J*(_>tt||-1),z()),o(ot-et)>U&&(ot=et-U*(et>ot||-1),z(!0)),vt={x1:l(n(_,tt)),x2:l(i(_,tt)),y1:u(n(et,ot)),y2:u(i(et,ot)),width:o(tt-_),height:o(ot-et)},b(),r.onSelectChange(d,m())}function C(e){return tt=/w|e|^$/.test(Y)||V?h(e):a(vt.x2),ot=/n|s|^$/.test(Y)||V?f(e):c(vt.y2),k(),!1}function A(t,o){tt=(_=t)+vt.width,ot=(et=o)+vt.height,e.extend(vt,{x1:l(_),y1:u(et),x2:l(tt),y2:u(ot)}),b(),r.onSelectChange(d,m())}function W(e){return _=i(L,n(q+h(e),L+D-vt.width)),et=i(j,n(B+f(e),j+R-vt.height)),A(_,et),e.preventDefault(),!1}function I(){e(document).unbind("mousemove",I),y(),tt=_,ot=et,k(),Y="",mt.is(":visible")||ut.add(mt).hide().fadeIn(r.fadeSpeed||0),Z=!0,e(document).unbind("mouseup",K).mousemove(C).one("mouseup",w),ut.unbind("mousemove",v),r.onSelectStart(d,m())}function K(){e(document).unbind("mousemove",I).unbind("mouseup",K),x(ut.add(mt)),p(l(_),u(et),l(_),u(et)),this instanceof e.imgAreaSelect||(r.onSelectChange(d,m()),r.onSelectEnd(d,m()))}function P(t){return 1!=t.which||mt.is(":animated")?!1:(y(),q=_=h(t),B=et=f(t),e(document).mousemove(I).mouseup(K),!1)}function N(){g(!1)}function H(){E=!0,O(r=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},r)),ut.add(mt).css({visibility:""}),r.show&&(Z=!0,y(),b(),ut.add(mt).hide().fadeIn(r.fadeSpeed||0)),setTimeout(function(){r.onInit(d,m())},0)}function M(e,t){for(var o in t)void 0!==r[o]&&e.css(t[o],r[o])}function O(o){if(o.parent&&($=e(o.parent)).append(ut.add(mt)),e.extend(r,o),y(),null!=o.handles){for(pt.remove(),pt=e([]),st=o.handles?"corners"==o.handles?4:8:0;st--;)pt=pt.add(t());pt.addClass(r.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:gt+1||1}),!parseInt(pt.css("width"))>=0&&pt.width(5).height(5),(dt=r.borderWidth)&&pt.css({borderWidth:dt,borderStyle:"solid"}),M(pt,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(Q=r.imageWidth/D||1,X=r.imageHeight/R||1,null!=o.x1&&(p(o.x1,o.y1,o.x2,o.y2),o.show=!o.hide),o.keys&&(r.keys=e.extend({shift:1,ctrl:"resize"},o.keys)),mt.addClass(r.classPrefix+"-outer"),ht.addClass(r.classPrefix+"-selection"),st=0;st++<4;)e(ft[st-1]).addClass(r.classPrefix+"-border"+st);M(ht,{selectionColor:"background-color",selectionOpacity:"opacity"}),M(ft,{borderOpacity:"opacity",borderWidth:"border-width"}),M(mt,{outerColor:"background-color",outerOpacity:"opacity"}),(dt=r.borderColor1)&&e(ft[0]).css({borderStyle:"solid",borderColor:dt}),(dt=r.borderColor2)&&e(ft[1]).css({borderStyle:"dashed",borderColor:dt}),ut.append(ht.add(ft).add(T)).append(pt),kt&&((dt=(mt.css("filter")||"").match(/opacity=(\d+)/))&&mt.css("opacity",dt[1]/100),(dt=(ft.css("filter")||"").match(/opacity=(\d+)/))&&ft.css("opacity",dt[1]/100)),o.hide?x(ut.add(mt)):o.show&&E&&(Z=!0,ut.add(mt).fadeIn(r.fadeSpeed||0),g()),V=(nt=(r.aspectRatio||"").split(/:/))[0]/nt[1],lt.add(mt).unbind("mousedown",P),r.disable||r.enable===!1?(ut.unbind("mousemove",v).unbind("mousedown",S),e(window).unbind("resize",N)):((r.enable||r.disable===!1)&&((r.resizable||r.movable)&&ut.mousemove(v).mousedown(S),e(window).resize(N)),r.persistent||lt.add(mt).mousedown(P)),r.enable=r.disable=void 0}var E,T,L,j,D,R,$,q,B,Q,X,Y,F,G,J,U,V,Z,_,et,tt,ot,it,nt,st,dt,rt,at,ct,lt=e(d),ut=t(),ht=t(),ft=t().add(t()).add(t()).add(t()),mt=t().add(t()).add(t()).add(t()),pt=e([]),yt={left:0,top:0},bt={left:0,top:0},gt=0,xt="absolute",vt={x1:0,y1:0,x2:0,y2:0,width:0,height:0},wt=document.documentElement,St=navigator.userAgent,zt=function(e){var t,o,s=r.keys,d=e.keyCode;if(t=isNaN(s.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(s.ctrl)&&e.ctrlKey?s.ctrl:!isNaN(s.shift)&&e.shiftKey?s.shift:isNaN(s.arrows)?10:s.arrows:s.alt,"resize"==s.arrows||"resize"==s.shift&&e.shiftKey||"resize"==s.ctrl&&e.ctrlKey||"resize"==s.alt&&(e.altKey||e.originalEvent.altKey)){switch(d){case 37:t=-t;case 39:o=i(_,tt),_=n(_,tt),tt=i(o+t,_),z();break;case 38:t=-t;case 40:o=i(et,ot),et=n(et,ot),ot=i(o+t,et),z(!0);break;default:return}k()}else switch(_=n(_,tt),et=n(et,ot),d){case 37:A(i(_-t,L),et);break;case 38:A(_,i(et-t,j));break;case 39:A(_+n(t,D-l(tt)),et);break;case 40:A(_,et+n(t,R-u(ot)));break;default:return}return!1};this.remove=function(){O({disable:!0}),ut.add(mt).remove()},this.getOptions=function(){return r},this.setOptions=O,this.getSelection=m,this.setSelection=p,this.cancelSelection=K,this.update=g;var kt=(/msie ([\w.]+)/i.exec(St)||[])[1],Ct=/opera/i.test(St),At=/webkit/i.test(St)&&!/chrome/i.test(St);for(it=lt;it.length;)gt=i(gt,isNaN(it.css("z-index"))?gt:it.css("z-index")),"fixed"==it.css("position")&&(xt="fixed"),it=it.parent(":not(body)");gt=r.zIndex||gt,kt&&lt.attr("unselectable","on"),e.imgAreaSelect.keyPress=kt||At?"keydown":"keypress",Ct&&(T=t().css({width:"100%",height:"100%",position:"absolute",zIndex:gt+2||2})),ut.add(mt).css({visibility:"hidden",position:xt,overflow:"hidden",zIndex:gt||"0"}),ut.css({zIndex:gt+2||2}),ht.add(ft).css({position:"absolute",fontSize:0}),d.complete||"complete"==d.readyState||!lt.is("img")?H():lt.one("load",H),!E&&kt&&kt>=7&&(d.src=d.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(void 0===t.enable&&void 0===t.disable&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}}(jQuery);