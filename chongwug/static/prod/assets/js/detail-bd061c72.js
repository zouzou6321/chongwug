!function(t){function e(e,i){i[0].reset(),N.resetForm(),i.find(".has-error").removeClass("has-error"),k.trigger("click"),e.text(function(){return t(this).data("text")}),y.tab("show")}function i(t){D=t,p.text(t.count),h.text(t.ordernum),v.text(t.farm),j.text(t.waitpoint),b.text(t.waittime),g.text(t.pay),T.text(t.orderno),I.attr("href",t.alipayurl),"lift"!=f.data("transportation")&&x.text("服务费")}function a(t){function e(){i--,i>0?(t.text(a+i),setTimeout(e,1e3)):(t.data("counting",!1),t.prop("disabled",!1).removeClass("disabled").text(a))}if(t.data("counting"))return!1;var i=t.data("delay"),a="重新发送 ";i=!isNaN(i)&&parseInt(i,10)||60,t.text(a+i),t.data("counting",!0),setTimeout(e,1e3)}function n(e,i,a){t.ajax({url:"./",data:e,dataType:"json",success:function(t){0==t.status?(i.html(K(t)),a()):alert(t.message)}})}function s(t,e){if(!e.hasClass("active")){var i=t.find(".active");i.removeClass("active"),e.addClass("active")}}var o=t(".cwg-thumb"),r=o.find(".img-small"),d=t(".cwg-thumbnail"),c=d.find("li"),l=[];t.each(c,function(e,i){l.push({src:t(i).data("src")})}),o.on("click",function(){t.magnificPopup.open({items:l,type:"image",gallery:{enabled:!0}},c.filter(".active").index())}),t(".thumbnail-wrap").simpleCarousel({itemWidth:66,prev:".prev-thumb",next:".next-thumb",callback:function(e){o.find(".img-original").remove(),r.attr("src",e.find("img").attr("src")),t("<img/>").addClass("img-full img-original mfp-zoom").attr("src",e.data("src")).insertAfter(r)}});var f=t("#js-order-modal"),u=f.find("#js-order-form"),m=f.find(".js-need-reset"),p=f.find("#js-other-order"),h=f.find("#js-queue-num"),v=f.find(".js-kennel-location"),j=f.find(".js-wait-location"),b=f.find(".js-wait-time"),g=f.find("#js-service-charge"),x=f.find("#js-charge-type"),y=f.find("#js-to-first"),k=f.find("#js-lift-btn"),C=f.find("#js-send-message"),w=f.find("#js-agreement"),I=f.find(".js-pay-link"),T=f.find("#js-charge-num"),D=null;t(".js-btn-order").on("click",function(){f.data("id",t(this).data("id")).modal("show")}),I.on("click",function(){t("#js-go-status").tab("show")}),t("#js-go-success").on("click",function(e){e.preventDefault(),e.stopPropagation();var i=t(this);t.ajax({url:"/buy/detail/attention/",data:{id:f.data("appointmentId")},dataType:"json",success:function(t){0==t.status?i.tab("show"):alert(t.message)}})});var N=u.validate({onsubmit:!1,errorElement:"p",errorClass:"help-block",ignore:"",rules:{phone:{minlength:11,maxlength:11,digits:!0}},highlight:function(e){t(e).closest(".form-group").addClass("has-error")},success:function(e){t(e).closest(".form-group").removeClass("has-error"),t(e).remove()}});t("#js-order-info").on("click",".next-step",function(){var e=t(this),a=t("#js-order-form").serializeArray(),n={};n.id=f.data("id");for(var s=0,o=a.length;o>s;s++){var r=a[s];n[r.name]=r.value}f.data("transportation",n.transportation),N.form(),N.numberOfInvalids()||t.ajax({url:"/buy/detail/attention/",type:"post",data:n,dataType:"json",beforeSend:function(){e.button("loading")},success:function(t){0==t.status?(i(t),f.data("appointmentId",t.id),e.tab("show")):alert(t.message)},complete:function(){e.button("reset")}})}),t("#js-order-confirm").on("click",".next-step",function(t){t.preventDefault(),w.is(":checked")||(alert("同意《宠物购用户协议》才能预约哟~"),t.stopPropagation())}),C.on("click",function(){t.ajax({url:"/buy/detail/attention/sendsms/",data:{id:f.data("appointmentId")},dataType:"json",beforeSend:function(){C.prop("disabled",!0).addClass("disabled")},success:function(t){0==t.status?(alert("发送成功，请注意查收"),a(C)):(alert(t.message),C.prop("disabled",!1).removeClass("disabled"))},error:function(){C.prop("disabled",!1).removeClass("disabled")}})}),f.on("show.bs.modal",function(){e(m,u)});var P=t("#js-affix-scrollspy");P.affix({offset:{top:600}}),t("body").scrollspy({target:"#js-affix-scrollspy"});var S="slideInDown",z="slideInUp";P.on("affix.bs.affix",function(){P.addClass(S+" animated").removeClass(z)}),P.on("affix-top.bs.affix",function(){P.addClass(z).removeClass(S)});var A=t("#js-location-box"),O=t("#js-btn-location"),q=t("#js-btn-time"),E=t("#js-time-box"),F=t("#js-time");E.on("click","td",function(){var e=t(this),i=e.closest("tr").find("th").text(),a=e.data();if(!e.hasClass("disabled")){E.find("td").not(e.addClass("active")).removeClass("active");var n=a.year+"-"+a.date+"（"+a.day+"）"+i;F.text(n),t("#js-time-input").val(a.year+"-"+a.date+" "+i),N.element("#js-time-input"),E.hide()}});var A=t("#js-location-box"),J=A.find("#province"),Q=A.find("#city"),U=A.find("#js-to-city"),W=A.find("#district"),B=A.find("#js-to-district"),G=A.find("#street"),H=A.find("#js-to-street"),K=template("location-select-tpl"),L={},M=[];J.on("click","a",function(){var e=t(this);s(J,e),M[0]=e.text(),L.province=e.data("id"),L.range=e.closest("dl").find("dt").data("id"),delete L.city,delete L.district,delete L.street,W.html(""),G.html(""),n(L,Q,function(){U.tab("show")})}),Q.on("click","a",function(){var e=t(this);s(Q,e),M[1]=e.text(),L.city=e.data("id"),delete L.district,delete L.street,G.html(""),n(L,W,function(){B.tab("show")})}),W.on("click","a",function(){var e=t(this);s(W,e),M[2]=e.text(),L.district=e.data("id"),delete L.street,n(L,G,function(){H.tab("show")})}),G.on("click","a",function(){var e=t(this);s(G,e),M[3]=e.text(),L.street=e.data("id");var i=M.join("-");t("#js-location").text(i),t("#js-location-input").val(JSON.stringify(L)),N.element("#js-location-input"),A.hide()}),q.on("click",function(){A.hide(),E.is(":visible")?E.hide():E.show()}),O.on("click",function(){E.hide(),A.is(":visible")?A.hide():A.show()}),t(document).on("click",function(e){var i=t(e.target),a=i.closest("#js-location-box"),n=i.closest("#js-time-box"),s=i.closest(".btn-select");a.length||n.length||s.length||(E.hide(),A.hide())})}(jQuery);