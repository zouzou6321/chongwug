!function(t){var e=t(".cwg-thumb"),i=e.find(".img-small"),n=t(".cwg-thumbnail"),a=n.find("li"),s=[];t.each(a,function(e,i){s.push({src:t(i).data("src")})}),e.on("click",function(){t.magnificPopup.open({items:s,type:"image",gallery:{enabled:!0}},a.filter(".active").index())}),t(".thumbnail-wrap").simpleCarousel({itemWidth:66,prev:".prev-thumb",next:".next-thumb",callback:function(n){e.find(".img-original").remove(),i.attr("src",n.find("img").attr("src")),t("<img/>").addClass("img-full img-original mfp-zoom").attr("src",n.data("src")).insertAfter(i)}})}(jQuery),function(t){var e=t("#js-affix-scrollspy");e.affix({offset:{top:600}}),t("body").scrollspy({target:"#js-affix-scrollspy"});var i="slideInDown",n="slideInUp";e.on("affix.bs.affix",function(){e.addClass(i+" animated").removeClass(n)}),e.on("affix-top.bs.affix",function(){e.addClass(n).removeClass(i)})}(jQuery),function(t){function e(e,i,n){t.ajax({url:"./",data:e,dataType:"json",success:function(t){0==t.status?(i.html(v(t)),n()):alert(t.message)}})}function i(t,e){if(!e.hasClass("active")){var i=t.find(".active");i.removeClass("active"),e.addClass("active")}}var n=t("#js-time-box"),a=t("#js-btn-time"),s=t("#js-time-input"),o=t("#js-time"),r=t("#js-location-box"),d=t("#js-btn-location"),c=t("#js-location-input"),l=t("#js-location"),f=r.find("#province"),u=r.find("#city"),m=r.find("#js-to-city"),p=r.find("#district"),h=r.find("#js-to-district"),g=r.find("#street"),j=r.find("#js-to-street"),v=template("location-select-tpl"),b={},x=[];a.on("click",function(){r.hide(),n.is(":visible")?n.hide():n.show()}),d.on("click",function(){n.hide(),r.is(":visible")?r.hide():r.show()}),t(document).on("click",function(e){var i=t(e.target),a=i.closest("#js-location-box"),s=i.closest("#js-time-box"),o=i.closest(".btn-select");a.length||s.length||o.length||(n.hide(),r.hide())}),n.on("click","td",function(){var e=t(this),a=t.trim(e.closest("tr").find("th").text()),r=e.data();if(!e.hasClass("disabled")){i(n,e);var d=r.year+"-"+r.date+"（"+r.day+"）"+a;o.text(d),s.val(r.year+"-"+r.date+" "+a),t(document).trigger("validate",{el:"#js-time-input"}),n.hide()}}),f.on("click","a",function(){var n=t(this);i(f,n),x[0]=n.text(),b.province=n.data("id"),b.range=n.closest("dl").find("dt").data("id"),delete b.city,delete b.district,delete b.street,p.html(""),g.html(""),e(b,u,function(){m.tab("show")})}),u.on("click","a",function(){var n=t(this);i(u,n),x[1]=n.text(),b.city=n.data("id"),delete b.district,delete b.street,g.html(""),e(b,p,function(){h.tab("show")})}),p.on("click","a",function(){var n=t(this);i(p,n),x[2]=n.text(),b.district=n.data("id"),delete b.street,e(b,g,function(){j.tab("show")})}),g.on("click","a",function(){var e=t(this);i(g,e),x[3]=e.text(),b.street=e.data("id");var n=x.join("-");l.text(n),c.val(JSON.stringify(b)),t(document).trigger("validate",{el:"#js-location-input"}),r.hide()})}(jQuery),function(t){function e(t){function e(){i--,i>0?(t.text(n+i),setTimeout(e,1e3)):(t.data("counting",!1),t.prop("disabled",!1).removeClass("disabled").text(n))}if(t.data("counting"))return!1;var i=t.data("delay"),n="重新发送短信 ";i=!isNaN(i)&&parseInt(i,10)||60,t.text(n+i),t.data("counting",!0),setTimeout(e,1e3)}function i(e,i){i[0].reset(),c.resetForm(),i.find(".has-error").removeClass("has-error"),d.trigger("click"),e.text(function(){return t(this).data("text")}),p.tab("show")}function n(t){f.text(t.count),u.text(t.ordernum),h.text(t.farm),g.text(t.waitpoint),j.text(t.waittime),v.text(t.pay),x.text(t.orderno),b.attr("href",t.alipayurl)}var a=t("#js-order-modal"),s=a.find(".js-need-reset"),o=a.find("#js-order-info"),r=o.find("#js-order-form"),d=r.find("#js-lift-btn"),c=r.validate({onsubmit:!1,errorElement:"p",errorClass:"help-block",ignore:"",rules:{phone:{minlength:11,maxlength:11,digits:!0}},highlight:function(e){t(e).closest(".form-group").addClass("has-error")},success:function(e){t(e).closest(".form-group").removeClass("has-error"),t(e).remove()}}),l=a.find("#js-order-confirm"),f=l.find("#js-other-order"),u=l.find("#js-queue-num"),m=l.find("#js-agreement"),p=l.find("#js-to-first"),h=a.find(".js-kennel-location"),g=a.find(".js-wait-location"),j=a.find(".js-wait-time"),v=a.find("#js-service-charge"),b=(a.find("#js-charge-type"),a.find(".js-pay-link")),x=a.find("#js-charge-num"),y=a.find("#js-to-status"),k=a.find("#js-to-success"),w=a.find("#js-send-message");t(".js-btn-order").on("click",function(){a.data("id",t(this).data("id")).modal("show")}),a.on("show.bs.modal",function(){i(s,r)}),t(document).on("validate",function(t,e){c.element(e.el)}),b.on("click",function(){y.tab("show")}),k.on("click",function(i){i.preventDefault(),i.stopPropagation();var n=t(this);t.ajax({url:"/buy/detail/attention/",data:{id:a.data("appointmentId")},dataType:"json",beforeSend:function(){n.button("loading")},success:function(t){0==t.status?(n.tab("show"),e(w)):alert(t.message)},complete:function(){n.button("reset")}})}),o.on("click",".next-step",function(){var e=t(this),i=r.serializeArray(),s={};s.id=a.data("id"),s.csrfmiddlewaretoken=t.cookie("csrftoken");for(var o=0,d=i.length;d>o;o++){var l=i[o];s[l.name]=l.value}c.form(),r.valid()&&t.ajax({url:"/buy/detail/attention/",type:"post",data:s,dataType:"json",beforeSend:function(){e.button("loading")},success:function(t){0==t.status?(n(t),a.data("appointmentId",t.id),e.tab("show")):alert(t.message)},complete:function(){e.button("reset")}})}),l.on("click",".next-step",function(t){t.preventDefault(),m.is(":checked")||(alert("同意《宠物购用户协议》才能预约哟~"),t.stopPropagation())}),w.on("click",function(){t.ajax({url:"/buy/detail/attention/sendsms/",data:{id:a.data("appointmentId")},dataType:"json",beforeSend:function(){w.prop("disabled",!0).addClass("disabled")},success:function(t){0==t.status?(alert("发送成功，请注意查收"),e(w)):(alert(t.message),w.prop("disabled",!1).removeClass("disabled"))},error:function(){w.prop("disabled",!1).removeClass("disabled")}})})}(jQuery);